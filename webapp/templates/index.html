{% extends "base.html" %}

{% block title %}ورود به پنل{% endblock %}

{% block content %}
    <div x-show="!user.uuid" class="login-container" x-transition.opacity>
        <div class="login-box">
            <div class="logo">پنل<span>کاربری</span></div>
            <p class="login-description">برای مشاهده اطلاعات، شناسه (UUID) خود را وارد کنید.</p>
            <div class="input-section">
                <input type="text" x-model="uuidInput" @keydown.enter="fetchData()" placeholder="شناسه (UUID)...">
                <button @click="fetchData()" :disabled="isLoading">
                    <span x-show="!isLoading">بررسی</span>
                    <div x-show="isLoading" class="spinner-small"></div>
                </button>
            </div>
            <div x-show="error" x-text="error" class="error-state" style="margin-top: 15px;"></div>
        </div>
    </div>

    <div x-show="user.uuid" x-cloak class="dashboard-layout fade-in-section">
        <aside class="sidebar">
            <div class="sidebar-header"><div class="logo" x-text="user.name || 'کاربر'"></div></div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" @click.prevent="setView('dashboard')" :class="{ 'active': activeView === 'dashboard' }"><i class="fas fa-tachometer-alt"></i> داشبورد</a></li>
                    <li><a href="#" @click.prevent="setView('chart')" :class="{ 'active': activeView === 'chart' }"><i class="fas fa-chart-line"></i> نمودار مصرف</a></li>
                    <li><a href="#" @click.prevent="setView('links')" :class="{ 'active': activeView === 'links' }"><i class="fas fa-link"></i> لینک اشتراک</a></li>
                    <li><a href="#" @click.prevent="setView('plans')" :class="{ 'active': activeView === 'plans' }"><i class="fas fa-rocket"></i> خرید سرویس</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer"><a href="#" @click.prevent="logout()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> خروج</a></div>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="header-center-content"><div class="welcome-message"><span class="welcome-text" x-text="activeViewTitle"></span></div></div>
                <div class="settings-card">
                    <div class="settings-list">
                        <div class="setting-item" @click="toggleTheme()"><div class="setting-icon"><i class="fas" :class="isLight ? 'fa-sun' : 'fa-moon'"></i></div></div>
                        <a :href="supportLink" target="_blank" class="setting-item" style="text-decoration: none;"><div class="setting-icon"><i class="fas fa-headset"></i></div></a>
                    </div>
                </div>
            </header>
            
            <div x-show="isLoading" class="loading-state-small">درحال بارگذاری...</div>

            <div x-show="!isLoading" class="main-view-content">
                {% include 'partials/_dashboard_content.html' %}
                {% include 'partials/_chart_content.html' %}
                {% include 'partials/_links_content.html' %}
                {% include 'partials/_plans_content.html' %}
            </div>
        </main>
    </div>

    <div x-show="qrVisible" x-cloak class="qr-modal" @click.self="qrVisible = false">
        <div class="qr-content" @click.stop>
            <h4 class="qr-title" x-text="qrTitle"></h4>
            <canvas id="qr-canvas" class="qr-image"></canvas>
            <div class="qr-buttons">
                <button class="copy-btn" @click="copyToClipboard(currentLink)">کپی لینک</button>
                <button class="close-btn" @click="qrVisible = false">بستن</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        const supportLink = "{{ support_link|safe }}";
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}