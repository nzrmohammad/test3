{% extends "base.html" %}

{% block title %}نمودار مصرف{% endblock %}

{% block page_content %}
<div class="main-wrapper">

    {% include 'partials/_sidebar_user.html' %}

    <div class="main-content">
        {% set page_title = 'نمودار مصرف روزانه' %}
        {% include 'partials/_header.html' %}

        <div class="content-body">
            <div class="card">
                <div class="card-header">
                    <h3>نمودار مصرف ۳۰ روز گذشته</h3>
                </div>
                <div class="card-body">
                    <div id="usageChart"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // دیتا به صورت JSON از سمت سرور به اینجا تزریق می‌شود
    const usageData = JSON.parse('{{ usage_data | tojson | safe }}');

    var options = {
        chart: {
            type: 'area',
            height: 350,
            zoom: { enabled: false },
            toolbar: { show: false },
            fontFamily: 'IRANSans, sans-serif' // اطمینان حاصل کنید این فونت در CSS شما وجود دارد
        },
        series: usageData.series,
        xaxis: {
            categories: usageData.categories
        },
        yaxis: {
            title: {
                text: 'مگابایت'
            },
            labels: {
                formatter: function (val) {
                    return val.toFixed(0);
                }
            }
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            curve: 'smooth'
        },
        tooltip: {
            y: {
                formatter: function (val) {
                    return val + " مگابایت";
                }
            }
        },
        fill: {
            type: 'gradient',
            gradient: {
                shadeIntensity: 1,
                opacityFrom: 0.7,
                opacityTo: 0.9,
                stops: [0, 90, 100]
            }
        },
    };

    var chart = new ApexCharts(document.querySelector("#usageChart"), options);
    chart.render();
});
</script>
{% endblock %}